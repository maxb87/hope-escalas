<h2><%= @scale_response.psychometric_scale.name %></h2>

<p>Responda a todos os itens abaixo. Selecione uma opção de 1 a 4 para cada pergunta.</p>

<%= form_with model: @scale_response, url: scale_responses_path, method: :post, data: { turbo: false } do |f| %>
  <% if @scale_response.errors.any? %>
    <div class="alert alert-danger" data-turbo-cache="false">
      <h4 class="mb-2"><%= t('errors.messages.not_saved', count: @scale_response.errors.count, resource: @scale_response.class.model_name.human.downcase) %></h4>
      <ul class="mb-0">
        <% @scale_response.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>
  <%= hidden_field_tag :scale_request_id, @scale_request.id %>
  
  <!-- Campos específicos para heterorrelato -->
  <% if @scale_response.hetero_report? %>
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">Informações do Relator</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <div class="mb-3">
              <%= f.label :relator_name, "Nome do Relator", class: "form-label" %>
              <%= f.text_field :relator_name, class: "form-control", placeholder: "Digite o nome completo do relator" %>
            </div>
          </div>
          <div class="col-md-6">
            <div class="mb-3">
              <%= f.label :relator_relationship, "Relação com o Paciente", class: "form-label" %>
              <%= f.text_field :relator_relationship, class: "form-control", placeholder: "Ex: Pai, Mãe, Cônjuge, Amigo, etc." %>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <div class="list-group">
    <% @scale_items.each do |item| %>
      <div class="list-group-item mb-3">
        <p><strong><%= item.item_number %>. <%= item.question_text %></strong></p>
        <div class="d-flex gap-3">
          <% item.options.sort_by { |k,_| k.to_i }.each do |score, label| %>
            <label class="form-check-label">
              <%= radio_button_tag "scale_response[answers][item_#{item.item_number}]", score, false, class: "form-check-input" %>
              <span><%= score %> — <%= label %></span>
            </label>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>

  <div class="mt-4">
    <%= f.submit t('scale_responses.new.submit'), class: "btn btn-primary" %>
  </div>
<% end %>
