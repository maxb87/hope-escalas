<% if user_signed_in? %>
  <% account = current_user.account %>
  <% is_admin = current_user.email == "admin@admin.com" %>
  <% is_professional = account.is_a?(Professional) %>
  <% is_patient = account.is_a?(Patient) %>

  <!-- Sidebar Toggle Button (Mobile) -->
  <button class="btn d-lg-none position-fixed top-0 start-0 mt-3 ms-3 z-3 border-0" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarOffcanvas" aria-controls="sidebarOffcanvas" style="background: white; border-radius: 8px; height: 44px; border: 2px solid #6c757d; box-shadow: 0 2px 4px rgba(0,0,0,0.1); padding: 0 12px;">
    <div class="d-flex align-items-center">
      <svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right: 8px;">
        <path d="M1 1H19" stroke="black" stroke-width="2" stroke-linecap="round"/>
        <path d="M1 8H19" stroke="black" stroke-width="2" stroke-linecap="round"/>
        <path d="M1 15H19" stroke="black" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span style="color: black; font-weight: 500; font-size: 14px;">Menu</span>
    </div>
  </button>

  <!-- Sidebar -->
  <div class="sidebar-container">
    <!-- Desktop Sidebar -->
    <nav class="sidebar d-none d-lg-flex flex-column p-3 bg-white border-end shadow-sm">
      <div class="sidebar-header mb-4">
        <h5 class="mb-0 text-primary">
          <i class="bi bi-heart-pulse me-2"></i>
          Hope Escalas
        </h5>
      </div>

      <ul class="nav nav-pills flex-column mb-auto">
        <% if is_patient %>
          <li class="nav-item mb-2">
            <%= link_to patients_dashboard_path,
                class: "nav-link d-flex align-items-center #{'active' if current_page?(patients_dashboard_path)}" do %>
              <i class="bi bi-house me-3 fs-5"></i>
              <span>Início</span>
            <% end %>
          </li>
        <% elsif is_professional || is_admin %>
          <li class="nav-item mb-2">
            <%= link_to scale_requests_path,
                class: "nav-link d-flex align-items-center #{'active' if current_page?(scale_requests_path)}" do %>
              <i class="bi bi-clipboard-data me-3 fs-5"></i>
              <span>Solicitações</span>
            <% end %>
          </li>

          <li class="nav-item mb-2">
            <%= link_to patients_path,
                class: "nav-link d-flex align-items-center #{'active' if current_page?(patients_path)}" do %>
              <i class="bi bi-list-check me-3 fs-5"></i>
              <span>Lista de Pacientes</span>
            <% end %>
          </li>

          <li class="nav-item mb-2">
            <%= link_to new_patient_path,
                class: "nav-link d-flex align-items-center #{'active' if current_page?(new_patient_path)}" do %>
              <i class="bi bi-person-plus me-3 fs-5"></i>
              <span>Cadastrar Paciente</span>
            <% end %>
          </li>

          <li class="nav-item mb-2">
            <%= link_to professionals_path,
                class: "nav-link d-flex align-items-center #{'active' if current_page?(professionals_path)}" do %>
              <i class="bi bi-people me-3 fs-5"></i>
              <span>Lista de Profissionais</span>
            <% end %>
          </li>

          <li class="nav-item mb-2">
            <%= link_to new_professional_path,
                class: "nav-link d-flex align-items-center #{'active' if current_page?(new_professional_path)}" do %>
              <i class="bi bi-person-badge me-3 fs-5"></i>
              <span>Cadastrar Profissional</span>
            <% end %>
          </li>
        <% end %>
      </ul>

      <hr class="my-3">

      <div class="sidebar-footer">
        <%= button_to destroy_user_session_path, method: :delete,
            class: "nav-link d-flex align-items-center text-danger border-0 bg-transparent" do %>
          <i class="bi bi-box-arrow-right me-3 fs-5"></i>
          <span>Sair</span>
        <% end %>
      </div>
    </nav>

    <!-- Mobile Offcanvas Sidebar -->
    <div class="offcanvas offcanvas-start d-lg-none" tabindex="-1" id="sidebarOffcanvas" aria-labelledby="sidebarOffcanvasLabel">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title text-primary" id="sidebarOffcanvasLabel">
          <i class="bi bi-heart-pulse me-2"></i>
          Hope Escalas
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body">
        <ul class="nav nav-pills flex-column">
          <% if is_patient %>
            <li class="nav-item mb-2">
              <%= link_to patients_dashboard_path,
                  class: "nav-link d-flex align-items-center #{'active' if current_page?(patients_dashboard_path)}",
                  onclick: "document.getElementById('sidebarOffcanvas').classList.remove('show'); document.querySelector('.offcanvas-backdrop').remove();" do %>
                <i class="bi bi-house me-3 fs-5"></i>
                <span>Início</span>
              <% end %>
            </li>
          <% elsif is_professional || is_admin %>
            <li class="nav-item mb-2">
              <%= link_to professionals_dashboard_path,
                  class: "nav-link d-flex align-items-center #{'active' if current_page?(professionals_dashboard_path)}",
                  onclick: "document.getElementById('sidebarOffcanvas').classList.remove('show'); document.querySelector('.offcanvas-backdrop').remove();" do %>
                <i class="bi bi-people me-3 fs-5"></i>
                <span>Pacientes</span>
              <% end %>
            </li>

            <li class="nav-item mb-2">
              <%= link_to scale_requests_path,
                  class: "nav-link d-flex align-items-center #{'active' if current_page?(scale_requests_path)}",
                  onclick: "document.getElementById('sidebarOffcanvas').classList.remove('show'); document.querySelector('.offcanvas-backdrop').remove();" do %>
                <i class="bi bi-list-check me-3 fs-5"></i>
                <span>Solicitações</span>
              <% end %>
            </li>

            <li class="nav-item mb-2">
              <%= link_to new_patient_path,
                  class: "nav-link d-flex align-items-center #{'active' if current_page?(new_patient_path)}",
                  onclick: "document.getElementById('sidebarOffcanvas').classList.remove('show'); document.querySelector('.offcanvas-backdrop').remove();" do %>
                <i class="bi bi-person-plus me-3 fs-5"></i>
                <span>Novo Paciente</span>
              <% end %>
            </li>

            <li class="nav-item mb-2">
              <%= link_to professionals_path,
                  class: "nav-link d-flex align-items-center #{'active' if current_page?(professionals_path)}",
                  onclick: "document.getElementById('sidebarOffcanvas').classList.remove('show'); document.querySelector('.offcanvas-backdrop').remove();" do %>
                <i class="bi bi-people me-3 fs-5"></i>
                <span>Lista de Profissionais</span>
              <% end %>
            </li>

            <li class="nav-item mb-2">
              <%= link_to new_professional_path,
                  class: "nav-link d-flex align-items-center #{'active' if current_page?(new_professional_path)}",
                  onclick: "document.getElementById('sidebarOffcanvas').classList.remove('show'); document.querySelector('.offcanvas-backdrop').remove();" do %>
                <i class="bi bi-person-badge me-3 fs-5"></i>
                <span>Cadastrar Profissional</span>
              <% end %>
            </li>
          <% end %>
        </ul>

        <hr class="my-3">

        <%= button_to destroy_user_session_path, method: :delete,
            class: "nav-link d-flex align-items-center text-danger border-0 bg-transparent",
            onclick: "document.getElementById('sidebarOffcanvas').classList.remove('show'); document.querySelector('.offcanvas-backdrop').remove();" do %>
          <i class="bi bi-box-arrow-right me-3 fs-5"></i>
          <span>Sair</span>
        <% end %>
      </div>
    </div>
  </div>

  <style>
    .sidebar-container {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      z-index: 1000;
    }

    .sidebar {
      width: 280px;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      background: white;
      z-index: 1000;
      overflow-y: auto;
    }

    .sidebar .nav-link {
      color: #6c757d;
      padding: 0.75rem 1rem;
      border-radius: 0.375rem;
      margin-bottom: 0.25rem;
      transition: all 0.2s ease-in-out;
    }

    .sidebar .nav-link:hover {
      color: #0d6efd;
      background-color: #f8f9fa;
    }

    .sidebar .nav-link.active {
      color: #0d6efd;
      background-color: #e7f1ff;
      font-weight: 500;
    }

    .sidebar .nav-link i {
      min-width: 20px;
    }

    .sidebar-header {
      border-bottom: 1px solid #e9ecef;
      padding-bottom: 1rem;
    }

    .sidebar-footer {
      padding-top: 1rem;
    }

    /* Main content adjustment for desktop */
    @media (min-width: 992px) {
      .main-content {
        margin-left: 280px;
        transition: margin-left 0.3s ease-in-out;
      }
    }

    /* Offcanvas backdrop adjustment */
    .offcanvas-backdrop {
      z-index: 1040;
    }

    .offcanvas {
      z-index: 1050;
    }

    /* Sidebar toggle button for mobile */
    .sidebar-toggle-mobile {
      z-index: 1030;
    }
  </style>
<% end %>
