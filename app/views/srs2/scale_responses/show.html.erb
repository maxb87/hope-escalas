<% is_patient = current_user.account_type == "Patient" %>
<% is_professional_or_admin = current_user.email == "admin@admin.com" || current_user.account_type == "Professional" %>


<% unless is_professional_or_admin %>
  <div class="row justify-content-center mb-4">
    <div class="col-md-8 col-lg-6">
      <h1 class="h3 mb-1">
        <i class="bi bi-clipboard-data me-2"></i>
        <%= @scale_response.psychometric_scale.name %> — Resultados 
      </h1>
    </div>
  </div>
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
      <div class="card border-0 shadow-sm" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
        <div class="card-body text-center p-4">
          <div class="mb-3">
            <i class="bi bi-clock-history text-primary" style="font-size: 3rem;"></i>
          </div>
          <h4 class="card-title text-primary mb-3">
            <i class="bi bi-hourglass-split me-2"></i>
            Aguardando Análise Profissional
          </h4>
          <p class="card-text text-muted mb-4 lead">
            Sua avaliação foi recebida com sucesso e está sendo processada por nossa equipe de profissionais.
          </p>
          <div class="alert alert-info border-0" style="background-color: rgba(13, 202, 240, 0.1);">
            <i class="bi bi-info-circle me-2"></i>
            <strong>Próximos passos:</strong> Mais informações sobre resultados, laudos e andamento de sua avaliação podem ser verificados em sua próxima consulta.
          </div>
          <div class="mt-3">
            <small class="text-muted">
              <i class="bi bi-shield-check me-1"></i>
              Seus dados estão seguros e serão analisados com total confidencialidade.
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>

<% unless is_patient %>

  <!-- Renderizar partial específico para SRS-2 -->
  <%= render 'srs2/scale_responses/show', scale_response: @scale_response, is_professional_or_admin: is_professional_or_admin %>

  <!-- Seção de Respostas do Paciente -->
  <div class="mt-4">
    <div class="accordion" id="patientResponsesAccordion">
      <div class="accordion-item">
        <h2 class="accordion-header" id="patientResponsesHeader">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#patientResponsesCollapse" aria-expanded="false" aria-controls="patientResponsesCollapse">
            <i class="bi bi-list-ul me-2"></i>
            <h3>Respostas do Paciente <span class="text-muted">(Clique para expandir)</span></h3>
          </button>
        </h2>
        <div id="patientResponsesCollapse" class="accordion-collapse collapse" aria-labelledby="patientResponsesHeader" data-bs-parent="#patientResponsesAccordion">
          <div class="accordion-body">
            <% if @scale_response.answers.present? %>
              <div class="row">
                <% @scale_response.answered_items.each do |item| %>
                  <div class="col-12 mb-3">
                    <div class="border rounded p-3 bg-light">
                      <p class="mb-2"><strong><%= item[:item_number] %>. <%= item[:question_text] %></strong></p>
                      <div class="alert alert-success mb-0">
                        <strong> Resposta:</strong> <%= item[:answer_value] %> — <%= item[:answer_text] %>
                      </div>
                    </div>
                  </div>
                <% end %>
              </div>
            <% else %>
              <div class="alert alert-warning">
                <strong>Nenhuma resposta encontrada</strong> para esta escala.
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>