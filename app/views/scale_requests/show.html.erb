<div class="d-flex justify-content-between align-items-center mb-4">
  <h1>
    <i class="bi bi-clipboard-data me-2"></i>
    <%= t('scale_requests.show.title') %>
  </h1>
  <%= link_to scale_requests_path, class: 'btn btn-outline-secondary' do %>
    <i class="bi bi-arrow-left me-1"></i>
    <%= t('actions.back') %>
  <% end %>
</div>

<div class="card">
  <div class="card-header">
    <h5 class="mb-0">
      <i class="bi bi-info-circle me-2"></i>
      Detalhes da Solicitação
    </h5>
  </div>
  <div class="card-body">
    <dl class="row">
      <dt class="col-sm-3">
        <i class="bi bi-person me-1"></i>
        <%= t('scale_requests.table.patient') %>
      </dt>
      <dd class="col-sm-9"><%= @scale_request.patient.full_name %></dd>

      <dt class="col-sm-3">
        <i class="bi bi-person-badge me-1"></i>
        <%= t('scale_requests.table.professional') %>
      </dt>
      <dd class="col-sm-9"><%= @scale_request.professional.full_name %></dd>

      <dt class="col-sm-3">
        <i class="bi bi-clipboard-pulse me-1"></i>
        <%= t('scale_requests.table.scale') %>
      </dt>
      <dd class="col-sm-9"><%= @scale_request.psychometric_scale.name %></dd>

      <dt class="col-sm-3">
        <i class="bi bi-activity me-1"></i>
        <%= t('scale_requests.table.status') %>
      </dt>
      <dd class="col-sm-9">
        <% case @scale_request.status %>
        <% when 'pending' %>
          <span class="badge bg-warning">
            <i class="bi bi-clock me-1"></i>
            <%= t('scale_requests.status.pending') %>
          </span>
        <% when 'completed' %>
          <span class="badge bg-success">
            <i class="bi bi-check-circle me-1"></i>
            <%= t('scale_requests.status.completed') %>
          </span>
        <% when 'cancelled' %>
          <span class="badge bg-danger">
            <i class="bi bi-x-circle me-1"></i>
            <%= t('scale_requests.status.cancelled') %>
          </span>
        <% end %>
      </dd>

      <dt class="col-sm-3">
        <i class="bi bi-calendar me-1"></i>
        <%= t('scale_requests.table.requested_at') %>
      </dt>
      <dd class="col-sm-9">
        <%= l(@scale_request.requested_at, format: :short) %>
        <small class="text-muted d-block">
          <%= time_ago_in_words(@scale_request.requested_at) %> atrás
        </small>
      </dd>

      <% if @scale_request.notes.present? %>
        <dt class="col-sm-3">
          <i class="bi bi-chat-text me-1"></i>
          Observações
        </dt>
        <dd class="col-sm-9"><%= @scale_request.notes %></dd>
      <% end %>
    </dl>

    <% if @scale_request.scale_response.present? %>
      <div class="alert alert-success">
        <h6 class="alert-heading">
          <i class="bi bi-check-circle me-2"></i>
          Escala Preenchida
        </h6>
        <p class="mb-2">
          Esta escala foi preenchida pelo paciente em 
          <%= l(@scale_request.scale_response.completed_at, format: :short) %>.
        </p>
        <hr>
        <p class="mb-0">
          <%= link_to scale_response_path(@scale_request.scale_response), 
              class: 'btn btn-success btn-sm' do %>
            <i class="bi bi-bar-chart me-1"></i>
            Ver Resultado da Escala
          <% end %>
        </p>
      </div>
    <% end %>
  </div>
</div>

<div class="mt-4 d-flex gap-2">
  <% if @scale_request.pending? && policy(@scale_request).cancel? %>
    <%= link_to cancel_scale_request_path(@scale_request), 
        data: { 
          turbo_method: :patch,
          confirm: t('scale_requests.actions.cancel_confirm') 
        }, 
        class: 'btn btn-warning' do %>
      <i class="bi bi-x-circle me-1"></i>
      <%= t('scale_requests.actions.cancel') %>
    <% end %>
  <% end %>

  <% if @scale_request.pending? && policy(@scale_request).respond? %>
    <%= link_to new_scale_response_path(scale_request_id: @scale_request.id), 
        class: 'btn btn-primary ms-auto' do %>
      <i class="bi bi-clipboard-check me-1"></i>
      <%= t('scale_requests.actions.fill_scale') %>
    <% end %>
  <% end %>
</div>
